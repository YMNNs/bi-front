### 通用信息

以下内容为所有 API 通用的信息。其他文章将会引用本文的一个或多个条目。

##### 版本管理规范

严格遵循 [Semantic Versioning 2.0.0](http://semver.org/lang/zh-CN/) 语义化版本规范。

##### 域名

| 变量名称  | URL  | 描述  |
| ------------ | ------------ | ------------ |
| baseUrl_dev  | http://bi.stager.top:8088  |  develop 分支后端请求地址 |
| baseUrl_master  | http://bi.stager.top:8080  |  master 分支后端请求地址 |
| frontUrl_dev  | http://bi-develop.stager.top |  develop 分支前端地址 |
| frontUrl_master | http://bi-master.stager.top  |  master 分支后端地址 |
| frontUrl_develop_verify_email|http://bi-develop.stager.top/verify_email?token= |develop 分支前端验证邮件 URL|
| frontUrl_master_verify_email|http://bi-develop.stager.top/verify_email?token= |master 分支前端验证邮件 URL|
| frontUrl_develop_reset_password|http://bi-develop.stager.top/reset_password?token= |develop 分支前端重置密码 URL|
| frontUrl_master_reset_password|http://bi-master.stager.top/reset_password?token= |master 分支前端重置密码 URL|

##### 输入格式

| 名称  | 类型  |  长度（包含） | 限制  |  错误提示 |
| ------------ | ------------ | ------------ | ------------ | ------------ |
|  用户名 | string  | 1-16  |  不与其他用户重复 | `用户名长度上限为 16 字符`、`用户名已被其他用户占用`  |
|  电子邮件地址 |  string | 无  | 不与其他用户重复  |  `电子邮件地址格式不正确`、`电子邮件地址已被其他用户占用` |
|密码|string|8-16|无|`密码长度应在 8-16 字符之间`|
|昵称|string|1-16|无|`昵称长度上限为 16 字符`|
|数据表名|string|1-128|无|`数据表名长度上限为 128 字符`|
|数据表描述|string|0-256|无|`数据表名长度上限为 256 字符`|
|图表名|string|1-128|无|`图表名长度上限为 128 字符`|

##### 图表类型

|  类型 id | 类型名称  |
| ------------ | ------------ |
| 1  |  折线图 |
| 2  |  柱状图 |
| 3  |  条形图 |
| 4  |  面积图 |
| 5  |  饼图 |
| 6  |  散点图 |
| 7  |  雷达图 |

### 公共请求参数

##### 简要描述

一个完整的 API 请求需要两类请求参数：公共请求参数和接口请求参数。本文将介绍 API 请求需要用到的 1 个公共请求参数。

公共请求参数是每个接口都需要使用到的请求参数，开发者每次发送请求时都需要携带这些公共请求参数和接口参数一起提交。

此参数位于请求头中。

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|Authorization |是  | |用户令牌   |

### 共通返回

这些返回在所有的接口都有可能返回，它们是所有接口共通的，在此统一说明，下面的接口将不再列出。

共通返回封装在`status`对象中，接口专属返回封装在`data`对象中。

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "Success"
    },
    "data": {
    }
}
```

##### 返回参数说明

|参数名|类型|说明|
|:-----  |:-----|-----                           |
|code|number|返回码|
|message|string|返回码描述|

##### 备注

为了避免和接口专属的返回码冲突，此处的返回码均不大于0。

|返回码|描述|
|:-----  |:-----|
|0|操作成功|
|-1|未携带 token|
|-2|token 过期或无效|
|-3|无权使用此接口|
|-4|接口已停用|
|-5|只允许 POST 方法|
|-6|只允许 GET 方法|
|-7|用户已停用|
|-8|字段值数据类型错误|
|-9|value格式不正确|
|-10|未知错误|

### 获取用户信息

##### 简要描述

- 本接口用于获取用户信息。该信息封装在`user`对象中。

##### 请求URL

- ` baseUrl/api/user/info `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "用户信息获取成功"
    },
    "data": {
        "user": {
            "id": 123,
            "username": "zhangsan",
            "nickname": "张三",
            "email": "zhangsan@bi.com",
            "email_verified": true,
            "status": "enabled",
            "role": "user",
            "last_login": "1623033546"
        }
    }
}
```

##### 返回参数说明

|参数名|类型|说明|
|:-----  |:-----|-----                           |
|id |number   |用户id  |
|username|string|用户名|
|nickname|string|昵称|
|email|string|电子邮件地址|
|email_verified|boolean|邮箱是否通过验证：`true`: 通过；`false`: 未通过。|
|status|string|用户状态：`enabled`：启用；`disabled`：停用。|
|role|string|用户角色：`user`：用户。|
|last_login|string|上次登录时间：`-1`：首次登录；其他：Unix时间戳|

- [Unix时间戳的使用方法](https://tool.chinaz.com/Tools/unixtime.aspx "Unix时间戳的使用方法")

### 登录

##### 简要描述

- 本接口用于登录。

##### 请求URL

- ` baseUrl/api/user/login `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|login |是  |string |用户名或电子邮件地址  |
|password |是  |string |密码（经过加密）  |
|rememberMe |是|boolean|记住登录信息|
|salt|是|string|加密参数|

- 密码加密模式：`md5(md5($password) + $salt)`，例如密码为`123456`，salt为`abcdef`，经过加密的密码即为`c7935cc8ee50b752345290d8cf136827`
  。其中数据库存储`md5($password)`。

> 登录请求无需传入`token`。

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|用户不存在|
|2|密码无效|
|3|电子邮件地址未激活|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "登录成功"
    },
    "data": {
        "token": "xxxxxxxxxxxxxxxxx"
    }
}
```

##### 返回参数说明

|参数名|类型|说明|
|:-----  |:-----|-----                           |
|token|string|用户令牌

- 登录失败时`data`对象为空。

### 注册

##### 简要描述

- 本接口用于注册。

##### 请求URL

- ` baseUrl/api/user/register `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|email|是|string|电子邮件地址|
|username|是|string|用户名|
|nickname|否|string|昵称|
|password|是|string|密码（明文）|

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|已禁止用户注册|
|11|电子邮件地址已被占用|
|12|电子邮件地址格式错误|
|21|用户名已被占用|
|22|用户名格式错误|
|32|昵称格式错误（允许重复）|
|42|密码格式错误|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "注册成功"
    },
    "data": {
        "token": "xxxxxxxxxxxxxxxxx"
    }
}
```

##### 返回参数说明

|参数名|类型|说明|
|:-----  |:-----|-----                           |
|token|string|用户令牌
|expire_time|string|`token`过期时间，格式为Unix时间戳|

- [Unix时间戳的使用方法](https://tool.chinaz.com/Tools/unixtime.aspx "Unix时间戳的使用方法")
- 注册失败时`data`对象为空。

### 退出登录

##### 简要描述

- 本接口用于退出登录，退出登录后token将会失效。

##### 请求URL

- ` baseUrl/api/user/logout `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "成功退出登录"
    },
    "data": null
}
```

### 修改用户信息

##### 简要描述

- 本接口用于修改用户信息。要修改的信息封装在`user`对象中。

##### 请求URL

- ` baseUrl/api/user/modify `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
| username |否| string| 用户名 |
| nickname |否| string| 昵称 |
| email |否| string| 电子邮件地址 |

##### 请求示例

```JSON
{
    "username": "xxxxxx",
    "nickname": "xxxxx",
    "email": "xxxx@xxx.xxxxx"
}
```

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
| x | 修改失败的字段数量|

- 只要有1个字段修改失败即撤销本次所有修改。

##### 返回示例

```JSON
{
    "status": {
        "code": 2,
        "message": "有2个字段修改失败"
    },
    "data": {
        "errors": [
            {
                "key": "username",
                "value": "用户名格式不正确"
            },
            {
                "key": "email",
                "value": "电子邮件地址已被占用"
            }
        ]
    }
}
```

##### 返回参数说明

|参数|类型|描述|
|:-------|:-------|:-------|
| - errors |object  | 错误列表 |
| key | string| 出现错误的字段名称 |
| value | string| 错误原因 |

### 删除账户

##### 简要描述

- 本接口用于删除账户。

##### 请求URL

- ` baseUrl/api/user/delete `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
|username |是 |string |用户名|
|password |是  |string |密码（经过加密）|
|salt|是|string|加密参数|

- 密码加密模式：`md5(md5($password) + $salt)`，例如密码为`123456`，salt为`abcdef`，经过加密的密码即为`c7935cc8ee50b752345290d8cf136827`
  。其中数据库存储`md5($password)`。

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|用户名或密码无效|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "用户已注销"
    },
    "data": null
}
```

### 检查可用性

##### 简要描述

- 本接口用于检查用户名、电子邮件地址和重置密码令牌的可用性。

##### 请求URL

- ` baseUrl/api/user/validate_username `
- ` baseUrl/api/user/validate_email `
- ` baseUrl/api/user/validate_reset_password_token`

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|username|是|string|需要检查的用户名|

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|email|是|string|需要检查的电子邮件地址|

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|reset_password_token|是|string|需要检查的重置密码令牌|

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
| 1  | 用户名已被占用 |
| 2 |用户名格式错误|

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
| 1  | 电子邮件地址已被占用 |
| 2 |电子邮件地址格式错误|

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
| 1  | 令牌无效或已过期 |

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "用户名可用"
    },
    "data": null
}
```

```JSON
{
    "status": {
        "code": 0,
        "message": "电子邮件地址可用"
    },
    "data": null
}
```

```JSON
{
    "status": {
        "code": 0,
        "message": "重置密码令牌可用"
    },
    "data": null
}
```

### 请求重置密码

##### 简要描述

- 本接口用于在未登录的情况下请求重置密码。

##### 请求URL

- ` baseUrl/api/user/request_reset_password `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|email|是|string|电子邮件地址|

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|2|电子邮件地址未注册|
|3|电子邮件地址对应的账户已停用（弃用）|
|4|禁止此用户重置密码(弃用)|
|5|电子邮件地址格式不正确|
|6|电子邮件地址未验证|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "已发送邮件"
    },
    "data": null
}
```

### 重置密码

##### 简要描述

- 本接口用于重置密码。

##### 请求URL

- ` baseUrl/api/user/reset_password `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|reset_password_token|是|string|重置密码令牌|
|password|是|string|密码(明文)|

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|重置密码令牌无效或已过期|
|7|密码格式错误|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "密码已重置"
    },
    "data": null
}
```

### 修改密码

##### 简要描述

- 本接口用于修改密码。

##### 请求URL

- ` baseUrl/api/user/change_password `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
|old_password|是|string|旧密码（明文）|
|new_password|是|string|新密码（明文）|

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|旧密码不匹配|
|2|已禁止该用户修改密码（弃用）|
|3|新密码格式错误|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "密码修改成功"
    },
    "data": null
}
```

### 激活电子邮件地址

##### 简要描述

- 本接口用于激活用户的电子邮件地址。

##### 请求URL

- ` baseUrl/api/user/activate_email `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|activation_token | 是  |string| 激活电子邮件地址令牌 |

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|激活电子邮件地址令牌过期或无效|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "电子邮件地址已激活"
    },
    "data": null
}
```

### 重新发送用于激活用户的邮件

##### 简要描述

- 本接口用于重新发送用于激活用户的邮件。该邮件地址存储在后端。

##### 请求URL

- ` baseUrl/api/user/resend_activation_email`

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|此账户的电子邮件地址已激活|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "邮件发送成功"
    },
    "data": null
}
```

### 请求获取数据库表

##### 简要描述

- 请求数据库中全部表信息

##### 请求URL

- ` baseUrl/api/data/all_tables `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |

##### 返回码

|返回码|描述|
|:----   |:---|
||   见：[共通返回](#共通返回 "共通返回")|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "数据库表信息获取成功"
    },
    "data": {
        "tables": [
            {
                "id": 1,
                "name": "豆瓣电影数据",
                "editable": false,
                "description": "按照豆瓣评分排序展示电影的基本信息"
            },
            {
                "id": 2,
                "name": "58租房数据",
                "editable": true,
                "description": "展示58同城租房网站的户型等基本信息"
            }
        ]
    }
}
```

##### 返回参数说明

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|id |是  |number |   表id|
|name |是  |string | 表名    |
|editable     |是  |boolean | 该表是否为样例数据    |
|description     |是  |string | 数据集描述    |

### 请求表的内容

##### 简要描述

- 分页请求获取某个数据表的部分内容

##### 请求URL

- ` baseUrl/api/data/table_content `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
|table_id |是  |number |  所请求表的id|
|max_length |否|number |每页最大数据量|
|offset|否|number|当前页号(从1开始)|

> 当 `max_length` 设置为`-1`时返回全部`dataSource`，设为`0`时不返回`dataSource`。上述两种情况时忽略`offset`

##### 请求示例

```JSON
{
    "table_id": 1,
    "max_length": 10,
    "offset": 1
}
```

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含共通返回。

|返回码|描述|
|:----   |:---|
||   见：[共通返回](#共通返回 "共通返回")|
|1|该表不存在|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "当前页内容信息获取成功"
    },
    "data": {
        "table": {
            "table_name": "豆瓣电影数据",
            "total": 100,
            "columns": [
                {
                    "title": "电影名称",
                    "dataIndex": "name",
                    "key": "name",
                    "type": "string"
                },
                {
                    "title": "评分",
                    "dataIndex": "rate",
                    "key": "rate",
                    "type": "number"
                },
                {
                    "title": "类型",
                    "dataIndex": "type",
                    "key": "type",
                    "type": "string"
                },
                {
                    "title": "地区",
                    "dataIndex": "country",
                    "key": "country",
                    "type": "string"
                },
                {
                    "title": "上映时间",
                    "dataIndex": "year",
                    "key": "year",
                    "type": "string"
                },
                {
                    "title": "评论数",
                    "dataIndex": "comment",
                    "key": "comment",
                    "type": "number"
                }
            ],
            "dataSource": [
                {
                    "ranking": 1,
                    "name": "肖申克的救赎",
                    "rate": 9.7,
                    "type": "犯罪 剧情",
                    "country": "美国",
                    "year": "1994-9",
                    "comment": 2365224
                },
                {
                    "ranking": 2,
                    "name": "霸王别姬",
                    "rate": 9.6,
                    "type": "爱情 剧情",
                    "country": "中国大陆 中国香港",
                    "year": "1993-7",
                    "comment": 1761207
                },
                {
                    "ranking": 3,
                    "name": "美丽人生",
                    "rate": 9.6,
                    "type": "剧情 喜剧",
                    "country": "意大利",
                    "year": "2020-1",
                    "comment": 1095584
                },
                {
                    "ranking": 4,
                    "name": "控方证人",
                    "rate": 9.6,
                    "type": "剧情 犯罪",
                    "country": "美国",
                    "year": "1957-12",
                    "comment": 371881
                },
                {
                    "ranking": 5,
                    "name": "伊丽莎白",
                    "rate": 9.6,
                    "type": "剧情 歌舞",
                    "country": "奥地利",
                    "year": "2005-12",
                    "comment": 5639
                },
                {
                    "ranking": 6,
                    "name": "阿甘正传",
                    "rate": 9.5,
                    "type": "剧情 爱情",
                    "country": "美国",
                    "year": "1994-6",
                    "comment": 1782286
                },
                {
                    "ranking": 7,
                    "name": "辛德勒的名单",
                    "rate": 9.5,
                    "type": "剧情 爱情",
                    "country": "美国",
                    "year": "1994-6",
                    "comment": 1782286
                },
                {
                    "ranking": 8,
                    "name": "茶馆",
                    "rate": 9.5,
                    "type": "剧情 历史",
                    "country": "中国大陆",
                    "year": "1982",
                    "comment": 68805
                },
                {
                    "ranking": 9,
                    "name": "控方证人",
                    "rate": 9.5,
                    "type": "剧情 犯罪",
                    "country": "美国 英国",
                    "year": "1982-12",
                    "comment": 32436
                },
                {
                    "ranking": 10,
                    "name": "十二怒汉",
                    "rate": 9.5,
                    "type": "剧情 犯罪",
                    "country": "美国",
                    "year": "1954-9",
                    "comment": 19810
                }
            ]
        }
    }
}
```

##### 返回参数说明

|参数名|类型|说明|
|:----    |:----- |-----   |
| table_name |object |   数据表名称|
| total |object |   数据表总数据量|
| columns |object |   列信息|
| - title |string|列名|
| - dataIndex |string|绑定标识|
| - key |string|列标识|
| dataSource |object | 表的内容    |

### 修改数据表名

##### 简要描述

- 请求修改样例数据名称接口

##### 请求URL

- ` baseUrl/api/data/change_table
  `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
|table_id |是  |number |数据集id   |
|table_name |是  |string | 新数据集名    |

##### 请求示例

```JSON
{
    "table_id": 1,
    "table_name": "豆瓣电影数据1"
}
```

##### 返回码

|返回码|描述|
|:----   |:---|
||   见：[共通返回](#共通返回 "共通返回")|
|1|   表不存在|
|2|   数据表名称不合法|

##### 返回示例

``` JSON
  {
    "status": {
    "code": 0,
    "message": "表名修改成功"
  },
    "data": null
  }
```

### 获取全部图表

##### 简要描述

- 本接口用于查询用户现有的图表、限额和已用数量

##### 请求URL

- ` baseUrl/api/chart/all `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "获取全部图表"
    },
    "data": {
        "all_charts": {
            "quota": 10,
            "charts": [
                {
                    "id": 1,
                    "chart_name": "My chart",
                    "type_id": 123,
                    "last_modified_time": 1623748364
                },
                {
                    "id": 2,
                    "chart_name": "My chart2",
                    "type_id": 124,
                    "last_modified_time": 1623748365
                }
            ]
        }
    }
}
```

##### 返回参数说明

|参数|类型|描述|
|:-------|:-------|:-------|
| quota | number| 用户的图表限额 |
| - - charts |object  | 图表对象 |
| id | number| 图表id |
| name | string| 图表名称 |
| type_id | number| 图表类型id |
| last_modified_time | number | 上次修改日期（Unix时间戳） |

### 创建图表

##### 简要描述

- 该接口用于选择图表类型及相关属性并生成

##### 请求URL

- ` baseUrl/api/chart/create `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
| data_id |是| number| 数据表id |
| type_id |是| number| 图表类型id |
| chart_name |是| string| 图表名称 |

##### 请求示例

```JSON
{
    "data_id": 0,
    "type_id": 0,
    "chart_name": "My chart"
}
```

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|图表名称为空|
|2|图表限额已满|
|3|图表构建失败|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "生成成功"
    },
    "data": {
        "chart_id": "152448854"
    }
}
```

##### 返回参数说明

|参数名|类型|说明|
|:-----  |:-----|-----                           |
|chart_id     |int |图表编号     |

### 编辑图表

##### 简要描述

- 本接口用于修改和保存图表

##### 请求URL

- ` baseUrl/api/chart/edit `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
|chart_id |是|number|图表id|
| type_id |否| number| 图表类型id |
| chart_name |否| string| 图表名称 |
| keys_number |否|object  | 指标列名 |
| keys_text |否|object  | 维度列名 |
| x_Field |否| string| 自变量 |
| y_Field |否| string| 因变量 |
| seriesField |否| string| 类别 |

##### 请求示例

```JSON
{
    "chart_id": 1,
    "type_id": 0,
    "chart_name": "My chart",
    "keys_number": [
        "rate",
        "comment"
    ],
    "keys_text": [
        "name"
    ],
    "x_Field": "name",
    "y_Field": "value",
    "seriesField": "category"
}
```

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|2|非空字段的字段值为空|

##### 返回示例

```JSON
  {
    "status": {
        "code": 0,
        "message": "图表已保存"
    },
    "data": null
}
```

### 删除图表

##### 简要描述

- 本接口用于用户删除已生成的图表

##### 请求URL

- ` baseUrl/api/chart/delete `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
|id|是|number|图表编号|

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|图表编号不存在|
|2|key键值不符合要求|

##### 返回示例

```JSON
   {
	"status": {
      "code": 0,
      "message": "删除成功"
     },
    "data": null
  }
```

### 向仪表盘添加图表（改逻辑）

##### 简要描述

- 本接口用于向仪表盘添加1个图表

##### 请求URL

- ` baseUrl/api/dashboard/add `

##### 请求方式

- POST

##### 请求示例

```JSON
{
    "chart_id": 123
}
```

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
|chart_id|是|number|图表id（用户图表的id）|

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|图表id不存在|
|2|仪表数量超出限制|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "仪表添加成功"
    },
    "data": {
        "id": 123
    }
}
```

##### 返回参数说明

|参数|类型|描述|
|:-------|:-------|:-------|
| id | number| 仪表id（仪表盘中的id） |

### 编辑仪表盘（2.0更新）

##### 简要描述

- 该接口用于编辑仪表盘内图表的位置和删除仪表盘中的图表

##### 请求URL

- ` baseUrl/api/dashboard/edit `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
| -instruments |是|object  | 图表对象 |
| id |是| number| 仪表id |
| number |是| number| 仪表顺序(从1开始) |
|chart_id|是|number| 图表id |
|data_id|是|number| 仪表所用数据集id |
|select_keys|是|string| 仪表中图表所用维度(从JSON序列化) |

##### 请求示例

```JSON
{
    "instruments": [
        {
            "id": 453,
            "number": 1,
            "chart_id": 2,
            "data_id": 1,
            "select_keys": "[\"南\", \"北\"]"
        },
        {
            "id": 454,
            "number": 2,
            "chart_id": 1,
            "data_id": 2,
            "select_keys": "[]"
        }
    ]
}
```

> 当`selected_keys`为空时默认为选择所有值

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|仪表id不存在|
|2|图表id不存在|
|3|仪表number重复(前端从1开始按顺序传给后端)|
|4|未发现修改内容（弃用）|
|5|number超出上限|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "修改成功"
    },
    "data": null
}
```

### 查看仪表盘（2.0更新）

##### 简要描述

- 本接口用于查看仪表盘

##### 请求URL

- ` baseUrl/api/dashboard/view `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "仪表盘请求成功"
    },
    "data": {
        "instruments": [
            {
                "id": 453,
                "index": 0,
                "chart_id": 2,
                "data_id": 1,
                "selected_keys": "[\"南\", \"北\"]"
            },
            {
                "id": 454,
                "index": 2,
                "chart_id": 1,
                "data_id": 2,
                "selected_keys": "[]"
            }
        ]
    }
}
```

##### 返回参数说明

|参数|类型|描述|
|:-------|:-------|:-------|
| - - instruments |object  | 仪表对象 |
| id | number| 仪表id |
| index | number| 仪表顺序（不要求连号，前端会按从小到大排序） |
| chart_id | number| 图表id |
| data_id | number |仪表所用数据集id|
| selected_keys | string | 仪表中图表所用维度（从JSON序列化） |

### 查看图表

##### 简要描述

- 该接口用于查看图表

##### 请求URL

- ` baseUrl/api/chart/view `

##### 请求方式

- POST

##### 参数

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
| id |是| number| 图表id |

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|图表id无效|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "请求图表成功"
    },
    "data": {
        "chart": {
            "type_id": 0,
            "data_id": 0,
            "chart_name": "My chart",
            "last_modified_time": 1623916319,
            "keys_number": [
                "rate",
                "comment"
            ],
            "keys_text": [
                "name"
            ],
            "xField": "name",
            "yField": "value",
            "seriesField": "category"
        }
    }
}
```

##### 返回参数说明

|参数|类型|描述|
|:-------|:-------|:-------|
| - - chart |object  | 图表对象 |
| type_id | number| 图表类型id |
| data_id | number| 数据表id |
| chart_name | string| 图表名称 |
| last_modified_time | number| 上次修改时间（Unix时间戳） |
|keys_number|Object|选中的指标列key|
|keys_text|Object|选中的维度列key|
| xField | string| 自变量名 |
| yField | string| 因变量名 |
| seriesField | string| 分组名 |

### 创建数据集

##### 简要描述

- 将用户上传的数据集（不含数据）导入至个人账号内

##### 请求URL

- ` baseUrl/api/data/create `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
| columns | 是 | object | 数据表表头 |

##### 请求示例

```JSON
{
    "columns": [
        {
            "title": "ccc",
            "key": "ccc",
            "dataIndex": "ccc",
            "type": "number"
        },
        {
            "title": "ddd",
            "key": "ddd",
            "dataIndex": "ddd",
            "type": "string"
        }
    ]
}
```

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含共通返回。

|返回码|描述|
|:----   |:---|
||   见：[共通返回](#共通返回 "共通返回")|
|1|存在空列名|
|2|存在重复列名|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "数据集导入成功"
    },
    "data": {
        "id": 1
    }
}
```

##### 返回参数说明

|参数名|类型|说明|
|:----    |:----- |-----   |
| id |number | 数据集主键 |

### 获取所有维度值

##### 简要描述

- 本接口用于某个图表所用数据集某一维度的所有值

##### 请求URL

- ` baseUrl/api/data/keys `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
|id|是|number|数据集主键|
|keyText|是|string|维度名称|

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含[共通返回](#共通返回 "共通返回")。

| 返回码  |  描述 |
| ------------ | ------------ |
|   | [共通返回](#共通返回 "共通返回")  |
|1|请求数据集不存在|
|2|请求维度不存在|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "数据维度请求成功"
    },
    "data": {
        "keys": [
            "南",
            "南 北"
        ]
    }
}
```

##### 返回参数说明

|参数|类型|描述|
|:-------|:-------|:-------|
| keys | object | 该维度的所有维度值 |

### 修改仪表盘尺寸

##### 简要描述

- 用以选择仪表盘内每行展示图表个数

##### 请求URL

- ` baseUrl/api/dashboard/change_size
  `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
|size | 是 |number |每行显示图表个数1-4|

##### 返回码

|返回码|描述|
|:----   |:---|
||   见：[共通返回](#共通返回 "共通返回")|
|1|   每行显示数量不符合限制|

##### 返回示例

```JSON
  {
    "status": {
        "code": 0,
        "message": "仪表盘尺寸修改成功"
    },
    "data": null
}
```

### 获取仪表尺寸

##### 简要描述

- 用以获取当前仪表盘内每行展示图表个数

##### 请求URL

- ` baseUrl/api/dashboard/size
  `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |

##### 返回码

|返回码|描述|
|:----   |:---|
||   见：[共通返回](#共通返回 "共通返回")|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "获取仪表盘尺寸成功"
    },
    "data": {
        "id": 2
    }
}
```

### 更新数据集中数据

##### 简要描述

- 更新用户数据集中数据（覆盖原数据）

##### 请求URL

- ` baseUrl/api/data/update `

##### 请求方式

- POST

##### 参数

以下请求参数列表仅列出了接口请求参数，正式调用时需要加上公共请求参数，见[公共请求参数](#公共请求参数 "公共请求参数")页面

|参数名|必选|类型|说明|
|:----    |:---|:----- |-----   |
|公共参数 |是  | |详见： [公共请求参数](#公共请求参数 "公共请求参数")   |
| id | 是 | number | 数据集主键 |
| name | 是 | string | 数据表名称 |
| description | 否 | string | 数据表描述 |
| dataSource | 是 | object | 数据集内容 |

> 将数据存入数据库时需为数据额外添加主键，且前端所传的`dataSource`中数据全部为string类型，需在后端在返回时将number类型值转换后传给前端

##### 请求示例

```JSON
{
    "id": 1,
    "name": "aaa",
    "description": "bbb",
    "dataSource": [
        {
            "ccc": "ccc1",
            "ddd": "ddd1"
        },
        {
            "ccc": "ccc2",
            "ddd": "ddd2"
        }
    ]
}
```

##### 返回码

以下请求参数列表仅列出了此接口请求响应代码，除此接口请求响应代码外。还包含共通返回。

|返回码|描述|
|:----   |:---|
||   见：[共通返回](#共通返回 "共通返回")|
|1|请求数据集不存在|
|2|插入数据列数不匹配|

##### 返回示例

```JSON
{
    "status": {
        "code": 0,
        "message": "数据集导入成功"
    },
    "data": null
}
```





